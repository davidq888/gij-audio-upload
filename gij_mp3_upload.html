<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="utf-8">
  <title>GIJ Transcriptietool</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      background: #f8f9fb;
      margin: 0;
      font-family: 'Inter', Arial, sans-serif;
    }
    .card {
      background: #fff;
      border-radius: 20px;
      box-shadow: 0 4px 24px 0 rgba(36,50,93,0.07);
      max-width: 1100px;
      margin: 48px auto 0 auto;
      padding: 54px 5% 74px 5%;
      min-height: 420px;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
    }
    h1 {
      font-size: 3rem;
      font-weight: 700;
      margin-top: 0;
      margin-bottom: 26px;
      color: #181E29;
      letter-spacing: -0.5px;
      text-align: left;
    }
    .description {
      font-size: 1.7rem;
      color: #636C79;
      margin-bottom: 2.3em;
      font-weight: 400;
      text-align: left;
    }
    .upload-area {
      display: flex;
      align-items: center;
      justify-content: flex-end;
      width: 100%;
      margin-top: 20px;
      margin-bottom: 0.5em;
    }
    #uploadForm {
      display: flex;
      align-items: center;
      gap: 14px;
    }
    .file-btn {
      display: inline-block;
      background: #fff;
      border: 2px solid #aaa;
      border-radius: 8px;
      padding: 10px 18px;
      cursor: pointer;
      font-weight: 500;
      color: #373A49;
      margin-right: 3px;
      transition: border 0.2s, color 0.2s;
    }
    .file-btn:hover { border-color: #4a90e2; color: #4a90e2; }
    #fileName {
      color: #636C79;
      font-size: 1rem;
      font-style: italic;
      margin-left: 2px;
      min-width: 60px;
      text-align: left;
    }
    #fileInput {
      display: none;
    }
    .upload-btn {
      background: #4a3aff;
      border: none;
      border-radius: 18px;
      color: #fff;
      font-size: 2rem;
      font-weight: 500;
      padding: 16px 38px;
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(74,58,255,0.09);
      transition: background 0.16s;
    }
    .upload-btn:hover {
      background: #372dd9;
    }
    #uploadProgressContainer {
      margin-top: 2.2em;
      max-width: 500px;
      margin-left: 0;
    }
    #uploadBar {
      width: 0;
      height: 100%;
      background: #4a90e2;
      transition: width 0.2s;
    }
    #uploadProgressContainer .bar-bg {
      width: 100%;
      margin: 1em 0;
      background: #e0e0e0;
      border-radius: 6px;
      height: 18px;
      overflow: hidden;
    }
    #uploadLabel {
      color: #444;
      font-size: 1em;
    }
    #transcribeIndicator {
      color: #444;
      font-size: 1em;
      margin-top: 1em;
    }
    .status, .error, .transcription {
      margin-top: 2em;
      font-size: 1.15rem;
      letter-spacing: 0.01em;
    }
    .status {
      color: #17a79c;
      font-weight: bold;
    }
    .error {
      color: #f13c63;
      margin-top: 1.2em;
    }
    .transcription {
      margin-top: 2.5em;
      background: #f6f8fa;
      padding: 24px;
      border-radius: 10px;
      color: #222;
      font-size: 1.22rem;
      white-space: pre-wrap;
      display: none;
      max-width: 90vw;
    }
    @media (max-width: 900px) {
      .card { padding: 32px 2% 40px 2%; }
      h1 { font-size: 2.1rem; }
      .description { font-size: 1.10rem; }
      .upload-btn { font-size: 1.15rem; padding: 12px 28px;}
      #uploadProgressContainer { max-width: 95vw; }
      .transcription { padding: 12px; }
    }
  </style>
</head>
<body>
  <div class="card">
    <h1>Upload audio en krijg de tekst</h1>
    <div class="description">
      Welkom bij de transcriptietool van GIJ.<br>
      Upload hier een geluidsbestand om automatisch de tekst te ontvangen.
    </div>
    <div class="upload-area">
      <form id="uploadForm">
        <input type="file" id="fileInput" name="file" accept="audio/*" required>
        <label for="fileInput" class="file-btn" id="fileLabel">Bestand kiezen</label>
        <span id="fileName"></span>
        <button type="submit" class="upload-btn">Upload</button>
      </form>
    </div>
    <div id="uploadProgressContainer" style="display:none;">
      <div class="bar-bg"><div id="uploadBar"></div></div>
      <div id="uploadLabel">Bezig met uploaden...</div>
    </div>
    <div id="transcribeIndicator" style="display:none;">Transcriptie wordt gemaakt...</div>
    <div class="status" id="result"></div>
    <div class="error" id="error"></div>
    <div class="transcription" id="transcription"></div>
  </div>
  <script>
    // Show the filename after choosing
    document.getElementById('fileInput').addEventListener('change', function(e){
      const fileName = e.target.files.length ? e.target.files[0].name : '';
      document.getElementById('fileName').textContent = fileName;
    });

    const publicKey = '2d337f1cae9ebe2ff0e5';
    document.getElementById('uploadForm').addEventListener('submit', function(e){
      e.preventDefault();
      document.getElementById('result').textContent = '';
      document.getElementById('error').textContent = '';
      document.getElementById('transcription').style.display = 'none';
      document.getElementById('uploadProgressContainer').style.display = 'none';
      document.getElementById('transcribeIndicator').style.display = 'none';
      const file = document.getElementById('fileInput').files[0];
      if (!file) return;
      // Show progress bar at start
      document.getElementById('uploadBar').style.width = '0';
      document.getElementById('uploadLabel').textContent = 'Bezig met uploaden...';
      document.getElementById('uploadProgressContainer').style.display = 'block';
      const formData = new FormData();
      formData.append('UPLOADCARE_PUB_KEY', publicKey);
      formData.append('UPLOADCARE_STORE', '1');
      formData.append('file', file);
      const xhr = new XMLHttpRequest();
      xhr.open('POST', 'https://upload.uploadcare.com/base/', true);
      xhr.upload.onprogress = function(e) {
        if (e.lengthComputable) {
          const percent = Math.round((e.loaded / e.total) * 100);
          document.getElementById('uploadBar').style.width = percent + '%';
          document.getElementById('uploadLabel').textContent = 'Uploaden: ' + percent + '%';
        }
      };
      xhr.onload = function(){
        document.getElementById('uploadProgressContainer').style.display = 'none';
        // Parse response and handle errors
        let data;
        try { data = JSON.parse(xhr.responseText); } catch (err) {}
        if (xhr.status !== 200 || !data || (!data.file && data.error)) {
          document.getElementById('error').textContent = 'Fout bij uploaden: ' + (data && data.error ? data.error.content : xhr.status);
          document.getElementById('result').textContent = '';
          return;
        }
        document.getElementById('result').textContent = 'Bestand geüpload!';
        // Show transcription-in-progress indicator (Dutch)
        document.getElementById('transcribeIndicator').style.display = 'block';
        const audioURL = 'https://ucarecdn.com/' + data.file + '/';
        fetch('https://lmtu8g.buildship.run/dutchAudioTranscriber-6891fe1d594e', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            audio_file: audioURL,
            language: 'nl'
          })
        })
        .then(res => res.json())
        .then(transcribeData => {
          document.getElementById('transcribeIndicator').style.display = 'none';
          if (transcribeData && transcribeData.output) {
            document.getElementById('transcription').style.display = 'block';
            document.getElementById('transcription').textContent = transcribeData.output;
            document.getElementById('result').textContent = 'Bestand geüpload en getranscribeerd.';
          } else {
            document.getElementById('transcription').style.display = 'block';
            document.getElementById('transcription').textContent = 'Transcriptie mislukt of niet ontvangen.';
            document.getElementById('result').textContent = 'Bestand geüpload. Geen transcriptie ontvangen.';
          }
        })
        .catch(err => {
          document.getElementById('transcribeIndicator').style.display = 'none';
          document.getElementById('transcription').style.display = 'block';
          document.getElementById('transcription').textContent = '';
          document.getElementById('error').textContent = 'Fout bij transcriptie: ' + err;
          document.getElementById('result').textContent = '';
        });
      };
      xhr.onerror = function(){
        document.getElementById('uploadProgressContainer').style.display = 'none';
        document.getElementById('error').textContent = 'Netwerkfout tijdens uploaden.';
        document.getElementById('result').textContent = '';
      };
      xhr.send(formData);
    });
  </script>
</body>
</html>
